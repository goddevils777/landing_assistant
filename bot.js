const TelegramBot = require('node-telegram-bot-api');
require('dotenv').config();

const bot = new TelegramBot(process.env.TELEGRAM_BOT_TOKEN, { polling: true });

// –•—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ç–∞–π–º–µ—Ä–æ–≤
const users = new Map();
// –ü–µ—Ä–≤—ã–π —É—Ä–æ–∫ - —Ç–µ–ø–µ—Ä—å –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç
const firstLessonText = `üìö *–£—Ä–æ–∫ 1: –†–æ–ª—å –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞ –≤ –±—ñ–∑–Ω–µ—Å—ñ*

üîπ *–£–ø—Ä–∞–≤–ª—è—î —á–∞—Å–æ–º* ‚Äî –ø–ª–∞–Ω—É—î –∑—É—Å—Ç—Ä—ñ—á—ñ, –∫–æ–Ω—Ç—Ä–æ–ª—é—î –¥–µ–¥–ª–∞–π–Ω–∏
üîπ *–§—ñ–ª—å—Ç—Ä—É—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é* ‚Äî –≤–∏–∑–Ω–∞—á–∞—î –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏, –≥–æ—Ç—É—î —Ä–µ–∑—é–º–µ  
üîπ *–ü—Ä–µ–¥—Å—Ç–∞–≤–ª—è—î –∫–æ–º–ø–∞–Ω—ñ—é* ‚Äî –≤–µ–¥–µ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–∏ –≤—ñ–¥ —ñ–º–µ–Ω—ñ –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞
üîπ *–í–∏—Ä—ñ—à—É—î –ø—Ä–æ–±–ª–µ–º–∏* ‚Äî –∑–Ω–∞—Ö–æ–¥–∏—Ç—å —Ä—ñ—à–µ–Ω–Ω—è –¥–æ —Ç–æ–≥–æ, —è–∫ –≤–æ–Ω–∏ —Å—Ç–∞–Ω—É—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∏–º–∏

üí° *–ü—Ä–∞–∫—Ç–∏—á–Ω–µ –∑–∞–≤–¥–∞–Ω–Ω—è:*
–°–∫–ª–∞–¥—ñ—Ç—å —ñ–¥–µ–∞–ª—å–Ω–∏–π —Ä–æ–∑–∫–ª–∞–¥ –¥–Ω—è –¥–ª—è –∫–µ—Ä—ñ–≤–Ω–∏–∫–∞ IT-–∫–æ–º–ø–∞–Ω—ñ—ó, –≤—Ä–∞—Ö–æ–≤—É—é—á–∏:
- 3 –≤–∞–∂–ª–∏–≤—ñ –∑—É—Å—Ç—Ä—ñ—á—ñ  
- –ß–∞—Å –Ω–∞ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É –ø–æ—à—Ç—É
- –û–±—ñ–¥–Ω—é –ø–µ—Ä–µ—Ä–≤—É
- –ß–∞—Å –¥–ª—è —Å—Ç—Ä–∞—Ç–µ–≥—ñ—á–Ω–æ–≥–æ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è`;

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start
bot.onText(/\/start/, (msg) => {
    const chatId = msg.chat.id;
    const userId = msg.from.id;
    
    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    bot.sendMessage(chatId, `–ü—Ä–∏–≤—ñ—Ç! üëã 
    
–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –Ω–∞ –∫—É—Ä—Å "–ê—Å–∏—Å—Ç–µ–Ω—Ç –ö–µ—Ä—ñ–≤–Ω–∏–∫–∞" –≤—ñ–¥ –î–∞—Ä—ñ—ó –ö–ª–∏–º–µ–Ω–∫–æ!

–ó–∞—Ä–∞–∑ –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –ø–µ—Ä—à–∏–π —É—Ä–æ–∫ –∞–±—Å–æ–ª—é—Ç–Ω–æ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ üéÅ`);
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤–∏–¥–µ–æ —É—Ä–æ–∫ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤–∏–¥–µ–æ —Ñ–∞–π–ª
        bot.sendVideo(chatId, './video/1less.mov', {
            caption: firstLessonText,
            parse_mode: 'Markdown'
        }).catch(error => {
            console.error('Error sending video:', error);
            // –ï—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç
            bot.sendMessage(chatId, `üìπ *–ü–µ—Ä—à–∏–π —É—Ä–æ–∫ (–≤—ñ–¥–µ–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ)*\n\n${firstLessonText}`, 
                { parse_mode: 'Markdown' });
        });
    }, 2000);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∞–π–º–µ—Ä –Ω–∞ 5 –º–∏–Ω—É—Ç
    users.set(userId, {
        chatId: chatId,
        startTime: Date.now()
    });
    
    setTimeout(() => {
        sendPaymentOffer(chatId, userId);
    }, 5 * 60 * 1000); // 5 –º–∏–Ω—É—Ç
});


const paymentOffer = `üéì *–ì–æ—Ç–æ–≤—ñ —Å—Ç–∞—Ç–∏ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–º –∞—Å–∏—Å—Ç–µ–Ω—Ç–æ–º?*

–û–±–µ—Ä—ñ—Ç—å –Ω–∞–π–∫—Ä–∞—â–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –¥–ª—è —Å–µ–±–µ:

üìö *–ö–£–†–° "–ê–°–ò–°–¢–ï–ù–¢ –ö–ï–†–Ü–í–ù–ò–ö–ê"* - 250$
- 7 –º–æ–¥—É–ª—ñ–≤ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ—ó –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏
- –°–µ—Ä—Ç–∏—Ñ—ñ–∫–∞—Ç –ø—Ä–æ –ø—Ä–æ—Ö–æ–¥–∂–µ–Ω–Ω—è
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó –∑ –î–∞—Ä—ñ—î—é
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –ø—Ä–æ—Ç—è–≥–æ–º 3 –º—ñ—Å—è—Ü—ñ–≤

üéØ *–ü–Ü–î–ë–Ü–† –ê–°–ò–°–¢–ï–ù–¢–ê –ó –ì–ê–†–ê–ù–¢–Ü–Ñ–Æ* - 350$
- –Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–π –≤—ñ–¥–±—ñ—Ä –∫–∞–Ω–¥–∏–¥–∞—Ç—ñ–≤
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å–≤—ñ–¥—É —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π
- –ì–∞—Ä–∞–Ω—Ç—ñ—è –∑–∞–º—ñ–Ω–∏ –ø—Ä–æ—Ç—è–≥–æ–º –º—ñ—Å—è—Ü—è
- –°—É–ø—Ä–æ–≤—ñ–¥ –Ω–∞ –ø–µ—Ä—à—ñ —Ç–∏–∂–Ω—ñ —Ä–æ–±–æ—Ç–∏

üíº *–ö–ê–†'–Ñ–†–ù–ê –ö–û–ù–°–£–õ–¨–¢–ê–¶–Ü–Ø* - 50$
- –ê–Ω–∞–ª—ñ–∑ –≤–∞—à–æ–≥–æ —Ä–µ–∑—é–º–µ
- –ü–æ—Ä–∞–¥–∏ —â–æ–¥–æ —Ä–æ–∑–≤–∏—Ç–∫—É –∫–∞—Ä'—î—Ä–∏
- –ü–ª–∞–Ω—É–≤–∞–Ω–Ω—è –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ–≥–æ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è
- –Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—è –ø–æ—à—É–∫—É —Ä–æ–±–æ—Ç–∏

üí∞ *–£—Å—ñ —Ü—ñ–Ω–∏ —Ñ—ñ–∫—Å–æ–≤–∞–Ω—ñ, –±–µ–∑ –ø—Ä–∏—Ö–æ–≤–∞–Ω–∏—Ö –ø–ª–∞—Ç–µ–∂—ñ–≤*`;


// –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–± –æ–ø–ª–∞—Ç–µ
// –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–± –æ–ø–ª–∞—Ç–µ
function sendPaymentOffer(chatId, userId) {
    const keyboard = {
        inline_keyboard: [
            [
                {
                    text: 'üìö –ö—É—Ä—Å - 250$',
                    url: 'https://revolut.me/dariiapcx7/usd250/–∫—É—Ä—Å-–∞—Å–∏—Å—Ç–µ–Ω—Ç-–∫–µ—Ä—ñ–≤–Ω–∏–∫–∞'
                }
            ],
            [
                {
                    text: 'üéØ –ü—ñ–¥–±—ñ—Ä –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞ –∑ –≥–∞—Ä–∞–Ω—Ç—ñ—î—é - 350$',
                    url: 'https://revolut.me/dariiapcx7/usd350/–ø—ñ–¥–±—ñ—Ä-–∞—Å–∏—Å—Ç–µ–Ω—Ç–∞-–≥–∞—Ä–∞–Ω—Ç—ñ—è'
                }
            ],
            [
                {
                    text: 'üíº –ö–∞—Ä\'—î—Ä–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è - 50$',
                    url: 'https://revolut.me/dariiapcx7/usd50/–∫–∞—Ä—î—Ä–Ω–∞-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—è'
                }
            ],
            [
                {
                    text: 'üìû –ó–≤\'—è–∑–∞—Ç–∏—Å—å –∑ –î–∞—Ä—ñ—î—é',
                    url: 'https://t.me/klymenkodariia'
                }
            ]
        ]
    };
    
    bot.sendMessage(chatId, paymentOffer, {
        parse_mode: 'Markdown',
        reply_markup: keyboard
    });
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —É—Ä–æ–∫
bot.on('message', (msg) => {
    const chatId = msg.chat.id;
    
    // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–∞–Ω–¥—ã
    if (msg.text && msg.text.startsWith('/')) return;
    
    // –û—Ç–≤–µ—Ç –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ
    if (msg.text && msg.text.length > 50) {
        bot.sendMessage(chatId, `–î—è–∫—É—é –∑–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∑–∞–≤–¥–∞–Ω–Ω—è! üëè

–í–∞—à –ø—ñ–¥—Ö—ñ–¥ –¥–æ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è –ø–æ–∫–∞–∑—É—î —Ä–æ–∑—É–º—ñ–Ω–Ω—è –æ—Å–Ω–æ–≤ —Ä–æ–±–æ—Ç–∏ –∞—Å–∏—Å—Ç–µ–Ω—Ç–∞.

–©–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω–∏–π —Ä–æ–∑–±—ñ—Ä –≤–∞—à–æ–≥–æ –∑–∞–≤–¥–∞–Ω–Ω—è —Ç–∞ –ø—Ä–æ–¥–æ–≤–∂–∏—Ç–∏ –Ω–∞–≤—á–∞–Ω–Ω—è, –ø–µ—Ä–µ—Ö–æ–¥—å—Ç–µ –¥–æ –ø–æ–≤–Ω–æ–≥–æ –∫—É—Ä—Å—É! üöÄ`);
    }
});

console.log('ü§ñ Telegram bot started');